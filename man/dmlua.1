.\" Automatically generated by Pandoc 3.8.3
.\"
.TH "DMLUA" "1" "" "Version 2.0.0" "User Commands"
.SH NAME
dmlua \(en passes received observations to Lua function
.SH SYNOPSIS
\f[B]dmlua\f[R] \-\-help
.PP
\f[B]dmlua\f[R] \-\-version
.PP
\f[B]dmlua\f[R] \-\-\f[B]node\f[R] \f[I]id\f[R] \-\-\f[B]script\f[R]
\f[I]file\f[R] [\-\-\f[B]procedure\f[R] \f[I]name\f[R]]
[\-\-\f[B]name\f[R] \f[I]name\f[R]] [\-\-\f[B]logger\f[R]
\f[I]name\f[R]] [\-\-\f[B]debug\f[R]] [\-\-\f[B]verbose\f[R]]
.PP
\f[B]dmlua\f[R] \-\-\f[B]config\f[R] \f[I]file\f[R] [\-\-\f[B]name\f[R]
\f[I]name\f[R]]
.SH DESCRIPTION
The \f[B]dmlua\f[R] program runs a custom Lua script to process
observations received from POSIX message queue.
Each observation is passed as a Lua table to the Lua function of the
name given in option \f[CR]procedure\f[R].
The function name \f[CR]process\f[R] is assumed by default.
The function must return the (modified) observation table on exit.
.PP
The observation returned from the Lua function will be forwarded to the
next specified receiver or discarded if no receivers are left.
.PP
The Lua script file will be executed after loading.
Any code outside of the Lua function will be evaluated once to allow an
(optional) initialisation of the script.
.SH OPTIONS
.TP
\f[B]\-\-config\f[R], \f[B]\-c\f[R] \f[I]file\f[R]
File path to the optional configuration file.
.TP
\f[B]\-\-debug\f[R], \f[B]\-D\f[R]
Forward logs messages of level \f[CR]LL_DEBUG\f[R] via IPC (if logger is
set).
.TP
\f[B]\-\-help\f[R], \f[B]\-h\f[R]
Print available command\-line arguments and quit.
.TP
\f[B]\-\-logger\f[R], \f[B]\-l\f[R] \f[I]name\f[R]
Name of logger.
If set, sends logs to \f[I]dmlogger(1)\f[R] process of given name.
.TP
\f[B]\-\-name\f[R], \f[B]\-n\f[R] \f[I]name\f[R]
Name of program instance and configuration (default is
\f[CR]dmlua\f[R]).
.TP
\f[B]\-\-node\f[R], \f[B]\-N\f[R] \f[I]id\f[R]
Node id.
.TP
\f[B]\-\-procedure\f[R], \f[B]\-p\f[R] \f[I]name\f[R]
Lua function name (default is \f[CR]process\f[R]).
.TP
\f[B]\-\-script\f[R], \f[B]\-s\f[R] \f[I]file\f[R]
Path to Lua script file.
.TP
\f[B]\-\-verbose\f[R], \f[B]\-V\f[R]
Print log messages to \f[I]stderr\f[R].
.TP
\f[B]\-\-version\f[R], \f[B]\-v\f[R]
Print version information and quit.
.SH EXIT STATUS
.TP
\f[B]0\f[R]
Success.
Process terminated without errors.
.TP
\f[B]1\f[R]
Failure.
Process failed.
.SH ENVIRONMENT
.TP
\f[B]DM_LOGGER\f[R]
Name of logger instance to send logs to.
.TP
\f[B]NO_COLOR\f[R]
Disable ANSI colour output.
.SH EXAMPLE
Wait for an observation on POSIX message queue \f[CR]/dmlua\f[R], pass
it as Lua table \f[CR]observ\f[R] to function \f[CR]process(observ)\f[R]
in \f[CR]script.lua\f[R], then forward the result to the next receiver:
.IP
.EX
$ dmlua \-n dmlua \-N dummy\-node \-s script.lua
.EE
