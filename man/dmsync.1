.\" Automatically generated by Pandoc 3.8.3
.\"
.TH "DMSYNC" "1" "" "Version 2.0.0" "User Commands"
.SH NAME
dmsync \(en synchronises databases between client and server
.SH SYNOPSIS
\f[B]dmsync\f[R] \-\-help
.PP
\f[B]dmsync\f[R] \-\-version
.PP
\f[B]dmsync\f[R] \-\-\f[B]database\f[R] \f[I]file\f[R]
\-\-\f[B]type\f[R] \f[I]type\f[R] \-\-\f[B]host\f[R] \f[I]host\f[R]
[\-\-\f[B]tls\f[R]] [\-\-\f[B]port\f[R] \f[I]port\f[R]]
[\-\-\f[B]username\f[R] \f[I]user\f[R]] [\-\-\f[B]password\f[R]
\f[I]password\f[R]] [\-\-\f[B]node\f[R] \f[I]id\f[R]]
[\-\-\f[B]interval\f[R] \f[I]seconds\f[R]] [\-\-\f[B]wait\f[R]
\f[I]name\f[R]] [\-\-\f[B]compression\f[R] \f[I]name\f[R]]
[\-\-\f[B]logger\f[R] \f[I]name\f[R]] [\-\-\f[B]create\f[R]]
[\-\-\f[B]debug\f[R]]
.PP
\f[B]dmsync\f[R] \-\-\f[B]config\f[R] \f[I]file\f[R] [\-\-\f[B]name\f[R]
\f[I]name\f[R]]
.SH DESCRIPTION
The \f[B]dmsync\f[R] program synchronises logs, nodes, observations,
sensors, and targets of a local database concurrently with an HTTP\-RPC
server.
The synchronisation may be started only once if no interval is set (to
transfer nodes, sensors, and targets from client to server),
periodically as a cron job, or by waiting for a POSIX semaphore.
.PP
The nodes, sensors, and targets referenced by observations in the local
database must also exist in the remote server database.
They can be created either with \f[I]dmdbcli(1)\f[R] or
\f[I]dmweb(1)\f[R], but also synchronised with \f[B]dmsync\f[R].
Logs and targets do not require any additional database entries on
server\-side.
.PP
The client databases must contain synchronisation tables.
The tables are created automatically by \f[I]dminit(1)\f[R] if
command\-line argument \f[CR]\-\-sync\f[R] is passed.
Alternatively, start \f[B]dmsync\f[R] with argument
\f[CR]\-\-create\f[R] once.
.PP
Database records are sent Zstandard\-compressed in Fortran 95 Namelist
format via HTTP to the server.
The program uses libcurl for data transfer.
The called HTTP\-RPC API endpoints are expected under base URI
\f[CR][http|https]://<host>:<port>/api/v2/\f[R].
.PP
The result of each synchronisation attempt is stored in the local
database.
Records are marked as synchronised only if the server returns HTTP 201
(Created).
.PP
Passing the server credentials via the command\-line arguments
\f[CR]\-\-username\f[R] and \f[CR]\-\-password\f[R] is insecure on
multi\-user operating systems and only recommended for testing.
.SH OPTIONS
.TP
\f[B]\-\-compression\f[R], \f[B]\-x\f[R] [none|zlib|zstd]
Compression library to use for payload data.
The default is \f[CR]zstd\f[R] (Zstandard).
Select \f[CR]zlib\f[R] for deflate compression or \f[CR]none\f[R] to
disable compression.
.TP
\f[B]\-\-config\f[R], \f[B]\-c\f[R] \f[I]file\f[R]
Path to configuration file.
.TP
\f[B]\-\-create\f[R], \f[B]\-C\f[R]
Create database synchronisation tables.
.TP
\f[B]\-\-database\f[R], \f[B]\-d\f[R] \f[I]file\f[R]
Path to SQLite log or observation database.
.TP
\f[B]\-\-debug\f[R], \f[B]\-D\f[R]
Forward logs messages of level \f[CR]LL_DEBUG\f[R] via IPC (if logger is
set).
.TP
\f[B]\-\-help\f[R], \f[B]\-h\f[R]
Print available command\-line arguments and quit.
.TP
\f[B]\-\-host\f[R], \f[B]\-H\f[R] \f[I]host\f[R]
IP address or FQDN of RPC API server.
.TP
\f[B]\-\-interval\f[R], \f[B]\-I\f[R] \f[I]seconds\f[R]
Synchronisation interval in seconds.
If set to \f[CR]0\f[R], only a single attempt is made (default).
.TP
\f[B]\-\-logger\f[R], \f[B]\-l\f[R] \f[I]name\f[R]
Name of logger.
If set, sends logs to \f[I]dmlogger(1)\f[R] process of given name.
.TP
\f[B]\-\-name\f[R], \f[B]\-n\f[R] \f[I]name\f[R]
Name of program instance and configuration.
.TP
\f[B]\-\-node\f[R], \f[B]\-N\f[R] \f[I]id\f[R]
Node id, required for types \f[CR]sensor\f[R] and \f[CR]observ\f[R].
.TP
\f[B]\-\-password\f[R], \f[B]\-P\f[R] \f[I]password\f[R]
RPC API password.
Be aware that passing the credentials via command\-line arguments is
insecure and only recommended for testing.
.TP
\f[B]\-\-port\f[R], \f[B]\-q\f[R] \f[I]port\f[R]
Port of RPC API server.
The default is \f[CR]0\f[R], which selects the port automatically
depending on the protocol.
.TP
\f[B]\-\-tls\f[R], \f[B]\-E\f[R]
Use TLS\-encrypted connection.
.TP
\f[B]\-\-type\f[R], \f[B]\-t\f[R] [log|node|observ|sensor|target]
Type of data to synchronise, either log, node, observation, sensor, or
target.
Type log requires a log database, all others an observation database.
.TP
\f[B]\-\-username\f[R], \f[B]\-U\f[R] \f[I]user\f[R]
RPC API user name.
If set, implies HTTP Basic Auth.
.TP
\f[B]\-\-verbose\f[R], \f[B]\-V\f[R]
Print log messages to \f[I]stderr\f[R].
.TP
\f[B]\-\-version\f[R], \f[B]\-v\f[R]
Print version information and quit.
.TP
\f[B]\-\-wait\f[R], \f[B]\-w\f[R]
Name of program to wait for.
Starts to synchronise once the named semaphore of the program is greater
0.
.SH EXIT STATUS
.TP
\f[B]0\f[R]
Success.
Synchronisation finished without errors.
.TP
\f[B]1\f[R]
Failure.
Synchronisation failed.
.SH ENVIRONMENT
.TP
\f[B]DM_LOGGER\f[R]
Name of logger instance to send logs to.
.TP
\f[B]NO_COLOR\f[R]
Disable ANSI colour output.
.SH EXAMPLE
Synchronise nodes, sensors, and targets with a remote HTTP\-RPC API:
.IP
.EX
$ dmsync \-d observ.db \-t node \-H example.com
$ dmsync \-d observ.db \-t sensor \-N dummy\-node \-H example.com
$ dmsync \-d observ.db \-t target \-H example.com
.EE
.PP
Synchronise observations:
.IP
.EX
$ dmsync \-d observ.db \-\-t observ \-H example.com
.EE
.PP
Synchronise log messages:
.IP
.EX
$ dmsync \-d log.db \-t log \-H example.com
.EE
.SH SEE ALSO
\f[I]dmapi(1)\f[R]
