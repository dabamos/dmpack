.TH "DMMB" "1" "" "Version 2.0.0" "User Commands"
.SH NAME
dmmb \(en reads observations from Modbus RTU/TCP device
.SH SYNOPSIS
\f[B]dmmb\f[R] \-\-help
.PP
\f[B]dmmb\f[R] \-\-version
.PP
\f[B]dmmb\f[R] \-\-\f[B]config\f[R] \f[I]file\f[R] [\-\-\f[B]name\f[R]
\f[I]name\f[R]] [\-\-\f[B]node\f[R] \f[I]id\f[R]] [\-\-\f[B]sensor\f[R]
\f[I]id\f[R]] [\-\-\f[B]logger\f[R] \f[I]name\f[R]]
[\-\-\f[B]format\f[R] \f[I]name\f[R]] [\-\-\f[B]output\f[R]
\f[I]file\f[R]] [\-\-\f[B]mqueue\f[R]] [\-\-\f[B]debug\f[R]]
[\-\-\f[B]verbose\f[R]]
.SH DESCRIPTION
The \f[B]dmmb\f[R] program reads values from or writes values to Modbus
RTU/TCP registers by sequentially processing the job list loaded from a
configuration file.
Each request of an observation must contain the Modbus register
parameters in the request string.
The value of the first response is set to the result of the read
operation.
Up to 8 requests to read and/or write values are permitted.
Integers read from a register may be scaled using an optional scale
denominator.
.PP
The following fields are supported in the command string:
.TP
\f[B]access\f[R] [read|write]
Read or write value of given type.
.TP
\f[B]address\f[R] \f[I]n\f[R]
Register address.
.TP
\f[B]code\f[R] \f[I]hex\f[R]
Optional Modbus function code in hexadecimal format.
Set to \f[CR]0x01\f[R] to read coil status and to \f[CR]0x05\f[R] to
write coil status.
.TP
\f[B]order\f[R] [abcd|badc|cdab|dcba]
Byte order of type \f[CR]float\f[R].
.TP
\f[B]scale\f[R] \f[I]n\f[R]
Optional integer scale denominator.
.TP
\f[B]slave\f[R] \f[I]id\f[R]
Slave id.
.TP
\f[B]type\f[R] [int16|int32|uint16|uint32|float]
Data type to read or write.
.TP
\f[B]value\f[R] \f[I]n\f[R]
Integer value to write.
.PP
For example, to read a 2\-byte unsigned integer from holding register
40050 of slave device 1 with a scale factor of 1/10, the attribute
\f[CR]request\f[R] of a request must be set to:
.IP
.EX
access=read, slave=1, address=40050, type=uint16, scale=10
.EE
.PP
Or, to read a 4\-byte floating\-point value in ABCD byte order from
register 40060:
.IP
.EX
access=read, slave=1, address=40060, type=float, order=abcd
.EE
.PP
Only integer values may be written to an input register, for instance:
.IP
.EX
access=write, slave=1, address=30010, type=uint16, value=1
.EE
.PP
The value is converted to \f[CR]uint16\f[R] automatically.
The command string can be in lower or upper case.
White spaces will be ignored.
.PP
Observations will be forwarded to the next receiver via POSIX message
queue if any receiver is specified.
The program can act as a sole data logger if output and format are set.
If the output path is set to \f[CR]\-\f[R], observations are printed to
\f[I]stdout\f[R], else to file.
.PP
A configuration file is required to configure the jobs to perform.
Each observation must have a valid target id.
The database must contain the specified node, sensor, and targets.
.SH OPTIONS
.TP
\f[B]\-\-config\f[R], \f[B]\-c\f[R] \f[I]file\f[R]
File path to the configuration file.
.TP
\f[B]\-\-debug\f[R], \f[B]\-D\f[R]
Forward logs messages of level \f[CR]LL_DEBUG\f[R] via IPC (if logger is
set).
.TP
\f[B]\-\-format\f[R], \f[B]\-f\f[R] [csv|jsonl]
Output format of observations if \f[CR]\-\-output\f[R] is set.
Either CSV or JSON Lines.
.TP
\f[B]\-\-help\f[R], \f[B]\-h\f[R]
Print available command\-line arguments and quit.
.TP
\f[B]\-\-logger\f[R], \f[B]\-l\f[R] \f[I]name\f[R]
Name of logger.
If set, sends logs to \f[I]dmlogger(1)\f[R] process of given name.
.TP
\f[B]\-\-name\f[R], \f[B]\-n\f[R] \f[I]name\f[R]
Name of program instance, configuration, and message queue (default is
\f[CR]dmmb\f[R]).
.TP
\f[B]\-\-mqueue\f[R], \f[B]\-Q\f[R]
Create message queue to receive observations.
.TP
\f[B]\-\-node\f[R], \f[B]\-N\f[R] \f[I]id\f[R]
Node id.
.TP
\f[B]\-\-output\f[R], \f[B]\-o\f[R] \f[I]file\f[R]
Output file to append observations to (\f[CR]\-\f[R] for
\f[I]stdout\f[R]).
.TP
\f[B]\-\-sensor\f[R], \f[B]\-S\f[R] \f[I]id\f[R]
Sensor id.
.TP
\f[B]\-\-verbose\f[R], \f[B]\-V\f[R]
Print log messages to \f[I]stderr\f[R].
.TP
\f[B]\-\-version\f[R], \f[B]\-v\f[R]
Print version information and quit.
.SH EXIT STATUS
.TP
\f[B]0\f[R]
Success.
Process terminated without errors.
.TP
\f[B]1\f[R]
Failure.
Process failed.
.SH ENVIRONMENT
.TP
\f[B]DM_LOGGER\f[R]
Name of logger instance to send logs to.
.TP
\f[B]NO_COLOR\f[R]
Disable ANSI colour output.
.SH EXAMPLE
Read the jobs to perform from configuration file and execute them
sequentially:
.IP
.EX
$ dmmb \-n dmmb \-c /usr/local/etc/dmpack/dmmb.conf \-V
.EE
.SH SEE ALSO
\f[I]dmmbctl(1)\f[R]
