.TH "DMUPLOAD" "1" "" "Version 2.0.0" "User Commands"
.SH NAME
dmupload \(en uploads images to RPC server
.SH SYNOPSIS
\f[B]dmupload\f[R] \-\-help
.PP
\f[B]dmupload\f[R] \-\-version
.PP
\f[B]dmupload\f[R] \-\-\f[B]node\f[R] \f[I]id\f[R]
\-\-\f[B]database\f[R] \f[I]file\f[R] \-\-\f[B]directory\f[R]
\f[I]path\f[R] \-\-\f[B]host\f[R] \f[I]host\f[R] [\-\-\f[B]tls\f[R]]
[\-\-\f[B]port\f[R] \f[I]port\f[R]] [\-\-\f[B]username\f[R]
\f[I]user\f[R]] [\-\-\f[B]password\f[R] \f[I]password\f[R]]
[\-\-\f[B]interval\f[R] \f[I]seconds\f[R]] [\-\-\f[B]compression\f[R]
\f[I]name\f[R]] [\-\-\f[B]wait\f[R] \f[I]name\f[R]]
[\-\-\f[B]logger\f[R] \f[I]name\f[R]] [\-\-\f[B]create\f[R]]
[\-\-\f[B]debug\f[R]]
.PP
\f[B]dmupload\f[R] \-\-\f[B]config\f[R] \f[I]file\f[R]
[\-\-\f[B]name\f[R] \f[I]name\f[R]]
.SH DESCRIPTION
The \f[B]dmupload\f[R] program uploads camera images from local database
and file system to a remote server through HTTP\-RPC API requests.
The upload may be started only once, periodically in a given interval,
or by waiting for a POSIX semaphore.
.PP
The image database must contain a synchronisation table.
The table is created automatically by \f[I]dminit(1)\f[R] if
command\-line argument \f[CR]\-\-sync\f[R] is passed.
Alternatively, start \f[B]dmupload\f[R] with argument
\f[CR]\-\-create\f[R] once.
.PP
The result of each upload attempt is stored in the local image database.
Records are marked as uploaded only if the server returns HTTP 201
(Created).
.PP
Passing the server credentials via the command\-line arguments
\f[CR]\-\-username\f[R] and \f[CR]\-\-password\f[R] is insecure on
multi\-user operating systems and only recommended for testing.
.SH OPTIONS
.TP
\f[B]\-\-compression\f[R], \f[B]\-x\f[R] [none|zlib|zstd]
Compression library to use for payload data.
The default is \f[CR]zstd\f[R] (Zstandard).
Select \f[CR]zlib\f[R] for deflate compression or \f[CR]none\f[R] to
disable compression.
.TP
\f[B]\-\-config\f[R], \f[B]\-c\f[R] \f[I]file\f[R]
Path to configuration file.
.TP
\f[B]\-\-create\f[R], \f[B]\-C\f[R]
Create database synchronisation table.
.TP
\f[B]\-\-database\f[R], \f[B]\-d\f[R] \f[I]file\f[R]
Path to SQLite image database.
.TP
\f[B]\-\-debug\f[R], \f[B]\-D\f[R]
Forward logs messages of level \f[CR]LL_DEBUG\f[R] via IPC (if logger is
set).
.TP
\f[B]\-\-directory\f[R], \f[B]\-p\f[R] \f[I]path\f[R]
Path to the directory of stored images.
.TP
\f[B]\-\-help\f[R], \f[B]\-h\f[R]
Print available command\-line arguments and quit.
.TP
\f[B]\-\-host\f[R], \f[B]\-H\f[R] \f[I]host\f[R]
IP address or FQDN of RPC API server.
.TP
\f[B]\-\-interval\f[R], \f[B]\-I\f[R] \f[I]seconds\f[R]
Upload interval in seconds.
By default, the interval is 0, which means that only a single image is
uploaded.
.TP
\f[B]\-\-logger\f[R], \f[B]\-l\f[R] \f[I]name\f[R]
Name of logger.
If set, sends logs to \f[I]dmlogger(1)\f[R] process of given name.
.TP
\f[B]\-\-name\f[R], \f[B]\-n\f[R] \f[I]name\f[R]
Name of program instance, configuration, and POSIX semaphore (default is
\f[CR]dmupload\f[R]).
.TP
\f[B]\-\-node\f[R], \f[B]\-N\f[R] \f[I]id\f[R]
Node id.
.TP
\f[B]\-\-password\f[R], \f[B]\-P\f[R] \f[I]password\f[R]
RPC API password.
Be aware that passing the credentials via command\-line arguments is
insecure and only recommended for testing.
.TP
\f[B]\-\-port\f[R], \f[B]\-q\f[R] \f[I]port\f[R]
Port of RPC API server.
The default is \f[CR]0\f[R], which selects the port automatically
depending on the protocol.
.TP
\f[B]\-\-tls\f[R], \f[B]\-E\f[R]
Use TLS\-encrypted connection.
.TP
\f[B]\-\-username\f[R], \f[B]\-U\f[R] \f[I]user\f[R]
RPC API user name.
If set, implies HTTP Basic Auth.
.TP
\f[B]\-\-verbose\f[R], \f[B]\-V\f[R]
Print log messages to \f[I]stderr\f[R].
.TP
\f[B]\-\-version\f[R], \f[B]\-v\f[R]
Print version information and quit.
.TP
\f[B]\-\-wait\f[R], \f[B]\-w\f[R]
Name of program to wait for.
Starts to uploads images once the named semaphore of the program is
greater 0.
.SH EXIT STATUS
.TP
\f[B]0\f[R]
Success.
Program executed without errors.
.TP
\f[B]1\f[R]
Failure.
Program execution failed.
.SH ENVIRONMENT
.TP
\f[B]DM_LOGGER\f[R]
Name of logger instance to send logs to.
.TP
\f[B]NO_COLOR\f[R]
Disable ANSI colour output.
.SH EXAMPLE
Upload image files stored in the passed database and directory to a
remote server:
.IP
.EX
$ dmupload \-N dummy\-node \-d /var/dmpack/image.db \(rs
  \-p /var/dmpack/images \-H example.com \-V
.EE
.SH SEE ALSO
\f[I]dmcamera(1)\f[R]
